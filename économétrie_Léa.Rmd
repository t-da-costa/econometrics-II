---
title: "Econométrie"
output:
  pdf_document: default
  html_document: default
date: "2025-01-18"
---
## Importation des données

```{r}
#importation des différentes librairies nécessaires pour la suite du projet
library(ggplot2)
library(cowplot)
library(car)
library(carData)
# library(caret)
library(FactoMineR)
library(readxl)
library(dplyr)
library(tidyr)
```

```{r}
#ouverture des jeux de données de consommation d'électricité des ménages
celec<-read_excel("celec_menages.xlsx", col_names = TRUE)
```
```{r}
#nous regardons la structure des données de la table "celec"
str(celec)
```
IPC : indice annuel des prix à la consommation
PIB2020 : produit intérieur brut en euros de 2020
Pelec : Prix de l'électricité des ménages (euro/MWh)
Pop1 : population France métropolitaine
DJU : Indice de rigueur du climat (MTES)
Celec_menages : consommation électrice GWh observée


## Analyse descriptive

```{r}
#la fonction summary nous permet d'obtenir une vue résumée de l'ensemble des données
summary(celec)
```

```{r}
# Transformer les données en format long
celec_long <- celec %>%
  pivot_longer(cols = c(Pelec, IPC, Celec_menages), names_to = "Variable", values_to = "Valeur")
```
```{r}
# Evolution consommation et prix de l'électricité comparativement à l'IPC
ggplot(celec_long, aes(x = Date, y = Valeur, color = Variable)) +
  geom_line(size = 1.2) +  
  labs(title = "Évolution du prix de l'électricité et de la consommation des ménages relativement à l'IPC",
       x = "Date", y = "Valeurs") +
  scale_color_manual(values = c("orange", "brown","red")) +  
  theme_minimal()
```

A partir de 2010, augmentation des prix de l'électricité plus fort que l'inflation.

```{r}
# données exemple
celec_long1 <- data.frame(
  Date = seq(1990, 2021, by = 1),
  DJU = runif(32, 0.8, 1.2),  # Valeurs aléatoires pour DJU
  Celec_menages = runif(32, 100, 200)  # Valeurs aléatoires pour Celec_menages
)

# Tracer le graphique avec deux axes Y
ggplot(celec_long1, aes(x = Date)) +
  # Tracer Celec_menages sur l'axe gauche
  geom_line(aes(y = Celec_menages, color = "Celec_menages"), size = 1.2) +
  # Tracer DJU sur l'axe droit
  geom_line(aes(y = DJU * 100, color = "DJU"), size = 1.2) +  # Multiplication par 100 pour ajuster l'échelle
  scale_color_manual(values = c("blue", "orange")) +  # Choix des couleurs pour les courbes
  scale_y_continuous(
    name = "Celec_menages",  # Axe gauche pour Celec_menages
    sec.axis = sec_axis(~ . / 100, name = "DJU")  # Axe droit pour DJU avec une transformation
  ) +
  labs(title = "Évolution de DJU et de Celec_menages",
       x = "Date", y = "Valeurs") +
  theme_minimal() +
  theme(legend.title = element_blank())  # Enlever le titre de la légende
```
Il serait intéressant de calculer un indice de corrélation ?

```{r}
resultat_acp <- PCA(celec, scale.unit = TRUE, graph = TRUE)
summary(resultat_acp)
```
Pop1, Date, IPC, PIB2020 très corrélés. DJU pas corrélé au reste. Pelec mal représenté.

Dim 1 semble être expliquée par Pop1, Date, Pelec
Dim 2 plutôt expliquée par DJU.

On utilise dim 1, dim 2 comme variables ?

```{r}
# Chargement des packages nécessaires
library(FactoMineR)  # Pour l'ACP
library(dplyr)       # Pour manipuler les données (optionnel)

# Étape 1 : Effectuer l'ACP
resultat_acp <- PCA(celec, scale.unit = TRUE, graph = FALSE)

# Étape 2 : Extraire les coordonnées des individus sur les composantes principales
# Par exemple, Dim1 et Dim2
coord_principales <- resultat_acp$ind$coord[, 1:2]  # Les deux premières dimensions

# Étape 3 : Créer un dataframe pour la régression
data_regression_acp <- cbind(coord_principales, Y = celec$Celec_menages)
data_regression_acp<-as.data.frame(data_regression_acp)

# Étape 4 : Ajuster le modèle de régression linéaire
modele_reg_acp <- lm(Y^3 ~ Dim.1 + Dim.2, data = data_regression_acp)

# Étape 5 : Résumé des résultats
summary(modele_reg_acp)

par(mfrow=c(2,2))
plot(modele_reg_acp)
```


```{r}
celec.lm=lm(Celec_menages~PIB2020 + Pop1 + DJU + Pelec + IPC + Date, data = celec)
par(mfrow=c(2,2))
plot(celec.lm)
```
```{r}
summary(celec.lm)
```
```{r}
step(celec.lm)
```

```{r}
celec.lm2=lm(Celec_menages~ DJU + Pelec + Date, data = celec)
par(mfrow=c(2,2))
plot(celec.lm2)
```
Violation hypothèses de normalité (residual vs fitted pas droit), de linéarité (les points s'écartent un peu de la ligne) et d'homoscédasticité (Scale-location légèrement en courbe en cloche).

Possibilitées :
- Tester des transformations des variables (logarithme, racine carrée, etc.).
- Ajouter des termes polynomiaux ou interactions pour mieux capturer la relation entre les variables.
- Vérifier les points influents et leur impact.
- Envisager des modèles robustes ou des approches comme Weighted Least Squares si l'hétéroscédasticité persiste.

```{r}
summary(celec.lm2)
```


TEST D'HETEROSCEDASTICITÉ 
```{r}
# Charger le package lmtest
library(lmtest)

# Appliquer le test de Goldfeld-Quandt
gqtest(celec.lm2, order.by = ~DJU, data = celec, fraction = 0.2)
```
Goldfeld-Quandt ne permet pas de rejeter l'hypothèse nulle sur aucune des trois variables explicatives.

```{r}
#test de White
library(lmtest)
white_test <- bptest(celec.lm2, ~ fitted(celec.lm2) + I(fitted(celec.lm2)))
print(white_test)
white_test <- bptest(celec.lm2, 
                     ~ DJU + Pelec + Date + I(DJU^2) + I(Pelec^2) + I(Date^2) + DJU:Pelec + DJU:Date + Pelec:Date, 
                     data = celec)
print(white_test)
```
Test de White ne donne rien non plus.
```{r}
#Test de Breusch et Pagan
bptest(celec.lm2)
bptest(celec.lm2, ~ DJU + Pelec + Date + I(DJU^2) + I(Pelec^2) + I(Date^2), data = celec)
```
```{r}
dwtest(celec.lm2)
```
Pas de preuve d'autocorrélation.
```{r}
bgtest(celec.lm2, order = 2)
```


